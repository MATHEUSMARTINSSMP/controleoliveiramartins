# Netlify Configuration

[build]
  command = "npm run build"
  publish = "dist"

# Scheduled Functions (alternativa ao pg_cron)
# Descomente se pg_cron não estiver disponível
# [[functions]]
#   name = "process-store-task-alerts-scheduled"
#   schedule = "* * * * *"  # A cada minuto

# Environment variables
[build.environment]
  NODE_VERSION = "18"
  # Desabilitar secrets scanning - VITE_SUPABASE_PUBLISHABLE_KEY é chave pública e DEVE estar no build
  SECRETS_SCAN_ENABLED = "false"

# Headers para garantir MIME types corretos
[[headers]]
  for = "/assets/*.js"
  [headers.values]
    Content-Type = "application/javascript; charset=utf-8"
    Cache-Control = "public, max-age=31536000, immutable"

# Redirecionamento para SPA - apenas para HTML
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false
  conditions = {Role = ["admin"], Country = ["!*"]}
  # Não aplicar para arquivos estáticos
  [[redirects.exceptions]]
    paths = ["/assets/*", "/static/*", "/*.js", "/*.css", "/*.png", "/*.jpg", "/*.svg", "/*.ico", "/*.json", "/sw.js", "/manifest.json"]

# Secrets scanning configuration
# ⚠️ IMPORTANTE: O Netlify detecta VITE_SUPABASE_PUBLISHABLE_KEY no build (isso é NORMAL e ESPERADO)
# A chave é PÚBLICA e DEVE estar no bundle do frontend para funcionar.
#
# Para resolver o erro de build, configure estas variáveis de ambiente no Netlify Dashboard:
# https://app.netlify.com/sites/eleveaone/configuration/env
#
# Opção 1 (Recomendado): Ignorar chaves específicas
# SECRETS_SCAN_OMIT_KEYS = "SUPABASE_ANON_KEY,VITE_SUPABASE_ANON_KEY,VITE_SUPABASE_PUBLISHABLE_KEY"
# SECRETS_SCAN_OMIT_PATHS = "dist/**"
#
# Opção 2: Executar o script automático
# bash configurar-netlify-secrets.sh
#
# Opção 3 (Não recomendado): Desabilitar completamente
# SECRETS_SCAN_ENABLED = "false"
